@model ReportesWeb1_2.ModelsReportes.CajeroReceptorModel
@using ReportesWeb1_2
@using Telerik.Reporting
@using Telerik.ReportViewer.Mvc
@{
    Layout = null;
}
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Telerik MVC HTML5 Report Viewer</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

    @*<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>

        <link href="http://kendo.cdn.telerik.com/2015.3.930/styles/kendo.common.min.css" rel="stylesheet" />
        <link href="http://kendo.cdn.telerik.com/2015.3.930/styles/kendo.blueopal.min.css" rel="stylesheet" />*@

    <script src="~/Scripts/jquery-1.9.1.min.js"></script>
    <link href="~/Scripts/kendo.blueopal.min.css" rel="stylesheet" />
    <link href="~/Scripts/kendo.common.min.css" rel="stylesheet" />
    @*<script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=Promise"></script>*@

    <!--kendo.all.min.js can be used as well instead of the following custom Kendo UI subset-->
    <script src="@Url.Content("~/ReportViewer/js/telerikReportViewer.kendo-12.2.18.912.min.js")"></script>

    <style>
        #reportViewer1 {
            position: relative;
            width: 1300px;
            height: 900px;
            font-family: Verdana, Arial;
        }
    </style>

    <script src="@Url.Content("~/ReportViewer/js/telerikReportViewer-12.2.18.912.min.js")"></script>
    <script src="~/Scripts/polyfill.min.js?features=Promise"></script>
</head>
<body>

    @{
        var typeReportSource = new TypeReportSource() { TypeName = typeof(ReportesWeb1_2.Views.Reportes.ReportBookCajeroReceptorToc).AssemblyQualifiedName };

        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par1", Model.PreCRViewModel.Par1));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par2", Model.PreCRViewModel.Par2));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par3", Model.PreCRViewModel.Par3.FirstOrDefault().Text));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par4", Model.PreCRViewModel.Par4));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par5", Model.PreCRViewModel.Par5));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par6", Model.PreCRViewModel.Par6));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par7", Model.PreCRViewModel.Par7));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par8", Model.PreCRViewModel.Par8));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par11", Model.PreCRViewModel.Par11));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par12", Model.PreCRViewModel.Par12));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par13", Model.PreCRViewModel.Par13));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par14", Model.PreCRViewModel.Par14));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par15", Model.PreCRViewModel.Par15));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par16", Model.PreCRViewModel.Par16));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par17", Model.PreCRViewModel.Par17));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par18", Model.PreCRViewModel.Par18));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par19", Model.PreCRViewModel.Par19));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par20", Model.PreCRViewModel.Par20));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par21", Model.PreCRViewModel.Par21));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par22", Model.PreCRViewModel.Par22));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par23", Model.PreCRViewModel.Par23));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par24", Model.PreCRViewModel.Par24));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par25", Model.PreCRViewModel.Par25));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par26", Model.PreCRViewModel.Par26));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par27", Model.PreCRViewModel.Par27));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par28", Model.PreCRViewModel.Par28));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par29", Model.PreCRViewModel.Par29));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par30", Model.PreCRViewModel.Par30));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par31", Model.PreCRViewModel.Par31));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par40", Model.PreCRViewModel.Par40));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par41", Model.PreCRViewModel.Par41));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par42", Model.PreCRViewModel.Par42));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par43", Model.PreCRViewModel.Par43));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par140", Model.PreCRViewModel.Par140));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par141", Model.PreCRViewModel.Par141));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par142", Model.PreCRViewModel.Par142));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par143", Model.PreCRViewModel.Par143));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par32", Model.PreCRViewModel.Par32));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par33", Model.PreCRViewModel.Par33));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par34", Model.PreCRViewModel.Par34));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par35", Model.PreCRViewModel.Par35));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par36", Model.PreCRViewModel.Par36));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par37", Model.PreCRViewModel.Par37));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par38", Model.PreCRViewModel.Par38));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par39", Model.PreCRViewModel.Par39));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par44", Model.PreCRViewModel.Par44));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par45", Model.PreCRViewModel.Par45));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par46", Model.PreCRViewModel.Par46));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par47", Model.PreCRViewModel.Par47));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par48", Model.PreCRViewModel.Par48));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par49", Model.PreCRViewModel.Par49));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par50", Model.PreCRViewModel.Par50));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par51", Model.PreCRViewModel.Par51));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par52", Model.PreCRViewModel.Par52));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par53", Model.PreCRViewModel.Par53));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par54", Model.PreCRViewModel.Par54));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par55", Model.PreCRViewModel.Par55));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par56", Model.PreCRViewModel.Par56));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par57", Model.PreCRViewModel.Par57));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par58", Model.PreCRViewModel.Par58));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par59", Model.PreCRViewModel.Par59));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par60", Model.PreCRViewModel.Par60));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par63", Model.PreCRViewModel.Par63));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par64", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par65", Model.PreCRViewModel.Par65));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par66", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par67", Model.PreCRViewModel.Par67));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par68", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par69", Model.PreCRViewModel.Par69));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par70", Model.PreCRViewModel.Par70));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par71", Model.PreCRViewModel.Par71));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par72", Model.PreCRViewModel.Par72));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par73", Model.PreCRViewModel.Par73));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par74", Model.PreCRViewModel.Par74));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par75", Model.PreCRViewModel.Par75));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par76", Model.PreCRViewModel.Par76));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par77", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par78", Model.PreCRViewModel.Par78));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par79", Model.PreCRViewModel.Par79));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par80", Model.PreCRViewModel.Par80));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par81", Model.PreCRViewModel.Par81));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par82", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par83", Model.PreCRViewModel.Par83));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par84", Model.PreCRViewModel.Par84));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par85", Model.PreCRViewModel.Par85));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par86", Model.PreCRViewModel.Par86));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par87", Model.PreCRViewModel.Par87));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par88", Model.PreCRViewModel.Par88));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par89", Model.PreCRViewModel.Par89));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par90", Model.PreCRViewModel.Par90));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par91", Model.PreCRViewModel.Par91));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par92", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par93", Model.PreCRViewModel.Par93));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par94", Model.PreCRViewModel.Par94));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par95", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par96", Model.PreCRViewModel.Par96));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par97", Model.PreCRViewModel.Par97));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par98", Model.PreCRViewModel.Par98));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par99", Model.PreCRViewModel.Par99));

        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).parelu1", Model.PreCRViewModel.Parelu1));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).parelu2", Model.PreCRViewModel.Parelu2));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).parelu3", Model.PreCRViewModel.Parelu3));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).parelu4", Model.PreCRViewModel.Parelu4));


        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par1", Model.ComCRViewModel.Par1.FirstOrDefault().Text));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par2", Model.ComCRViewModel.Par2));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par3", Model.ComCRViewModel.Par3));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par4", Model.ComCRViewModel.Par4));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par5", Model.ComCRViewModel.Par5));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par6", Model.ComCRViewModel.Par6));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par7", Model.ComCRViewModel.Par7));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par8", Model.ComCRViewModel.Par8));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par9", Model.ComCRViewModel.Par9));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par10", Model.ComCRViewModel.Par10));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par11", Model.ComCRViewModel.Par11));

        int count = 12;
        while (count <= 539)
        {
            var param = Model.ComCRViewModel.GetType().GetProperty("Par" + count).GetValue(Model.ComCRViewModel, null);
            typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par" + count, param == null ? "" : param));
            count++;
        }

        var reportProcessor = new Telerik.Reporting.Processing.ReportProcessor();

        // set any deviceInfo settings if necessary
        var deviceInfo = new System.Collections.Hashtable();

        Telerik.Reporting.Processing.RenderingResult result = reportProcessor.RenderReport("PDF", typeReportSource, deviceInfo);

        // NOMBRE DE TURNO PreTCViewModel.Par4
        string fileName = $"REPORTE CARRIL {Model.PreCRViewModel.Par2}" + "." + result.Extension;

        // NOMBRE  PreTCViewModel.Par1 10/15/2019
        string path = $"C:\\ReportesWeb\\{Model.PreCRViewModel.Par1.Substring(6, 4)}\\{Model.PreCRViewModel.Par1.Substring(0, 2)}\\{Model.PreCRViewModel.Par1.Substring(3, 2)}\\";
        if (!Directory.Exists(path))
        {
            Directory.CreateDirectory(path);
        }

        string filePath = System.IO.Path.Combine(path, fileName);

        using (System.IO.FileStream fs = new System.IO.FileStream(filePath, System.IO.FileMode.Create))
        {
            fs.Write(result.DocumentBytes, 0, result.DocumentBytes.Length);
        }
    }

    @(Html.TelerikReporting().ReportViewer()
                            // Each report viewer must have an id - it will be used by the initialization script
                            // to find the element and initialize the report viewer.
                            .Id("reportViewer1")
                            // The URL of the service which will serve reports.
                            // The URL corresponds to the name of the controller class (ReportsController).
                            // For more information on how to configure the service please check http://www.telerik.com/help/reporting/telerik-reporting-rest-conception.html.
                            .ServiceUrl(Url.Content("~/api/reports"))
                            // The URL for custom report viewer template. The template can be edited -
                            // new functionalities can be added and unneeded ones can be removed.
                            // For more information please check http://www.telerik.com/help/reporting/html5-report-viewer-templates.html.
                            //
                            // Strongly typed ReportSource - TypeReportSource or UriReportSource.
                            //.ReportSource(new TypeReportSource() { TypeName = "ReportesWeb1_2.ReportBookCajeroReceptor, ReportesWeb1_2, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" })
                            .ReportSource(typeReportSource)
                            // Specifies whether the viewer is in interactive or print preview mode.
                            // PrintPreview - Displays the paginated report as if it is printed on paper. Interactivity is not enabled.
                            // Interactive - Displays the report in its original width and height with no paging. Additionally interactivity is enabled.
                            .ViewMode(ViewMode.Interactive)
                            // Sets the scale mode of the viewer.
                            // Three modes exist currently:
                            // FitPage - The whole report will fit on the page (will zoom in or out), regardless of its width and height.
                            // FitPageWidth - The report will be zoomed in or out so that the width of the screen and the width of the report match.
                            // Specific - Uses the scale to zoom in and out the report.
                            .ScaleMode(ScaleMode.Specific)
                            // Zoom in and out the report using the scale
                            // 1.0 is equal to 100%, i.e. the original size of the report
                            .Scale(1.0)
                            // Sets whether the viewer�s client session to be persisted between the page�s refreshes(ex. postback).
                            // The session is stored in the browser�s sessionStorage and is available for the duration of the page session.
                            .PersistSession(false)
                            // Sets the print mode of the viewer.
                            .PrintMode(PrintMode.ForcePDFPlugin)
                            //Switches accessibility mode ON or OFF.
                            .EnableAccessibility(true)
    )

    <br />
    @Html.ActionLink("Regresar a Inicio", "Index", "Home")

</body>
</html>