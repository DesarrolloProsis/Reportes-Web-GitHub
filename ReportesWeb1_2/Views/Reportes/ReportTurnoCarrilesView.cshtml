@model ReportesWeb1_2.ModelsReportes.TurnoCarrilesModel
@using ReportesWeb1_2.Views.Reportes
@using Telerik.Reporting
@using Telerik.ReportViewer.Mvc
@{
    Layout = null;
}
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Telerik MVC HTML5 Report Viewer</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

    @*<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>

        <link href="http://kendo.cdn.telerik.com/2015.3.930/styles/kendo.common.min.css" rel="stylesheet" />
        <link href="http://kendo.cdn.telerik.com/2015.3.930/styles/kendo.blueopal.min.css" rel="stylesheet" />*@

    <script src="~/Scripts/jquery-1.9.1.min.js"></script>
    <link href="~/Scripts/kendo.blueopal.min.css" rel="stylesheet" />
    <link href="~/Scripts/kendo.common.min.css" rel="stylesheet" />

    <!--kendo.all.min.js can be used as well instead of the following custom Kendo UI subset-->
    <script src="@Url.Content("~/ReportViewer/js/telerikReportViewer.kendo-12.1.18.620.min.js")"></script>

    <style>
        #reportViewer1 {
            position: relative;
            width: 1300px;
            height: 900px;
            font-family: Verdana, Arial;
        }
    </style>

    <script src="@Url.Content("~/ReportViewer/js/telerikReportViewer-12.1.18.620.min.js")"></script>
    <script src="~/Scripts/polyfill.min.js?features=Promise"></script>

</head>
<body>

    @{
        var typeReportSource = new TypeReportSource() { TypeName = typeof(ReportesWeb1_2.Views.Reportes.ReportBookTurnoCarrilesToc).AssemblyQualifiedName };

        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par1", Model.PreTCViewModel.Par1));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par2", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par3", Model.PreTCViewModel.Par3));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par4", Model.PreTCViewModel.Par4));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par5", Model.PreTCViewModel.Par5));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par6", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par7", Model.PreTCViewModel.Par7));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par8", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par9", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par10", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par11", Model.PreTCViewModel.Par11));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par12", Model.PreTCViewModel.Par12));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par13", Model.PreTCViewModel.Par13));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par14", Model.PreTCViewModel.Par14));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par15", Model.PreTCViewModel.Par15));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par16", Model.PreTCViewModel.Par16));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par17", Model.PreTCViewModel.Par17));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par18", Model.PreTCViewModel.Par18));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par19", Model.PreTCViewModel.Par19));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par20", Model.PreTCViewModel.Par20));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par21", Model.PreTCViewModel.Par21));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par22", Model.PreTCViewModel.Par22));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par23", Model.PreTCViewModel.Par23));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par24", Model.PreTCViewModel.Par24));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par25", Model.PreTCViewModel.Par25));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par26", Model.PreTCViewModel.Par26));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par27", Model.PreTCViewModel.Par27));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par28", Model.PreTCViewModel.Par28));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par29", Model.PreTCViewModel.Par29));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par30", Model.PreTCViewModel.Par30));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par31", Model.PreTCViewModel.Par31));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par40", Model.PreTCViewModel.Par40));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par41", Model.PreTCViewModel.Par41));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par42", Model.PreTCViewModel.Par42));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par43", Model.PreTCViewModel.Par43));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par140", Model.PreTCViewModel.Par140));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par141", Model.PreTCViewModel.Par141));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par142", Model.PreTCViewModel.Par142));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par143", Model.PreTCViewModel.Par143));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par32", Model.PreTCViewModel.Par32));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par33", Model.PreTCViewModel.Par33));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par34", Model.PreTCViewModel.Par34));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par35", Model.PreTCViewModel.Par35));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par36", Model.PreTCViewModel.Par36));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par37", Model.PreTCViewModel.Par37));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par38", Model.PreTCViewModel.Par38));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par39", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par44", Model.PreTCViewModel.Par44));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par45", Model.PreTCViewModel.Par45));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par46", Model.PreTCViewModel.Par46));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par47", Model.PreTCViewModel.Par47));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par48", Model.PreTCViewModel.Par48));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par49", Model.PreTCViewModel.Par49));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par50", Model.PreTCViewModel.Par50));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par51", Model.PreTCViewModel.Par51));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par52", Model.PreTCViewModel.Par52));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par53", Model.PreTCViewModel.Par53));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par54", Model.PreTCViewModel.Par54));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par55", Model.PreTCViewModel.Par55));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par56", Model.PreTCViewModel.Par56));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par57", Model.PreTCViewModel.Par57));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par58", Model.PreTCViewModel.Par58));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par59", Model.PreTCViewModel.Par59));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par60", Model.PreTCViewModel.Par60));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par61", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par62", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par63", Model.PreTCViewModel.Par63));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par64", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par65", Model.PreTCViewModel.Par65));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par66", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par67", Model.PreTCViewModel.Par67));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par68", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par69", Model.PreTCViewModel.Par69));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par70", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par71", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par72", Model.PreTCViewModel.Par72 == null ? "" : Model.PreTCViewModel.Par72));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par73", Model.PreTCViewModel.Par73 == null ? "" : Model.PreTCViewModel.Par73));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par74", Model.PreTCViewModel.Par74 == null ? "" : Model.PreTCViewModel.Par74));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par75", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par76", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par77", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par78", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par79", Model.PreTCViewModel.Par79 == null ? "" : Model.PreTCViewModel.Par79));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par80", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par81", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par82", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par83", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par84", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par85", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par86", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par87", Model.PreTCViewModel.Par87 == null ? "" : Model.PreTCViewModel.Par87));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par88", Model.PreTCViewModel.Par88 == null ? "" : Model.PreTCViewModel.Par88));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par89", Model.PreTCViewModel.Par89));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par90", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par91", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par92", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par93", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par94", Model.PreTCViewModel.Par94));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par95", "0"));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par96", Model.PreTCViewModel.Par96));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par97", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par98", Model.PreTCViewModel.Par98));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).par99", Model.PreTCViewModel.Par99));

        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).parelu1", Model.PreTCViewModel.Parelu1));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).parelu2", Model.PreTCViewModel.Parelu2));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).parelu3", Model.PreTCViewModel.Parelu3));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(1).parelu4", Model.PreTCViewModel.Parelu4));

        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par1", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par2", Model.ComTCViewModel.Par2));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par3", Model.ComTCViewModel.Par3));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par4", Model.ComTCViewModel.Par4));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par5", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par6", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par7", Model.ComTCViewModel.Par7));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par8", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par9", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par10", ""));
        typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par11", ""));

        int count = 12;
        while (count <= 539)
        {
            if (count == 426)
            {
                typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par" + count, "0"));
                count++;
            }
            else
            {
                var param = Model.ComTCViewModel.GetType().GetProperty("Par" + count).GetValue(Model.ComTCViewModel, null);
                typeReportSource.Parameters.Add(new Telerik.Reporting.Parameter("reports(0).par" + count, param == null ? "" : param));
                count++;
            }
        }

        var reportProcessor = new Telerik.Reporting.Processing.ReportProcessor();

        // set any deviceInfo settings if necessary
        var deviceInfo = new System.Collections.Hashtable();

        Telerik.Reporting.Processing.RenderingResult result = reportProcessor.RenderReport("PDF", typeReportSource, deviceInfo);

        // NOMBRE DE TURNO PreTCViewModel.Par4
        string fileName = $"REPORTE TURNO {Model.PreTCViewModel.Par4}" + "." + result.Extension;

        // NOMBRE  PreTCViewModel.Par1 10/15/2019
        string path = $"C:\\ReportesWeb\\{Model.PreTCViewModel.Par1.Substring(6, 4)}\\{Model.PreTCViewModel.Par1.Substring(0, 2)}\\{Model.PreTCViewModel.Par1.Substring(3, 2)}\\";
        if (!Directory.Exists(path))
        {
            Directory.CreateDirectory(path);
        }

        string filePath = System.IO.Path.Combine(path, fileName);

        using (System.IO.FileStream fs = new System.IO.FileStream(filePath, System.IO.FileMode.Create))
        {
            fs.Write(result.DocumentBytes, 0, result.DocumentBytes.Length);
        }
    }

    @(Html.TelerikReporting().ReportViewer()
        // Each report viewer must have an id - it will be used by the initialization script
        // to find the element and initialize the report viewer.
        .Id("reportViewer1")
        // The URL of the service which will serve reports.
        // The URL corresponds to the name of the controller class (ReportsController).
        // For more information on how to configure the service please check http://www.telerik.com/help/reporting/telerik-reporting-rest-conception.html.
        .ServiceUrl(Url.Content("~/api/reports"))
        // The URL for custom report viewer template. The template can be edited -
        // new functionalities can be added and unneeded ones can be removed.
        // For more information please check http://www.telerik.com/help/reporting/html5-report-viewer-templates.html.
        // 
        // Strongly typed ReportSource - TypeReportSource or UriReportSource.
        //.ReportSource(new TypeReportSource() { TypeName = "ReportesWeb1_2.Views.Reportes.ReportBookTurnoCarriles, ReportesWeb1_2, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" })
        .ReportSource(typeReportSource)
        // Specifies whether the viewer is in interactive or print preview mode.
        // PrintPreview - Displays the paginated report as if it is printed on paper. Interactivity is not enabled.
        // Interactive - Displays the report in its original width and height with no paging. Additionally interactivity is enabled.
        .ViewMode(ViewMode.Interactive)
        // Sets the scale mode of the viewer.
        // Three modes exist currently:
        // FitPage - The whole report will fit on the page (will zoom in or out), regardless of its width and height.
        // FitPageWidth - The report will be zoomed in or out so that the width of the screen and the width of the report match.
        // Specific - Uses the scale to zoom in and out the report.
        .ScaleMode(ScaleMode.Specific)
        // Zoom in and out the report using the scale
        // 1.0 is equal to 100%, i.e. the original size of the report
        .Scale(1.0)
        // Sets whether the viewer�s client session to be persisted between the page�s refreshes(ex. postback).
        // The session is stored in the browser�s sessionStorage and is available for the duration of the page session.
        .PersistSession(false)
        // Sets the print mode of the viewer.
        .PrintMode(PrintMode.ForcePDFPlugin)
        //Switches accessibility mode ON or OFF.
        .EnableAccessibility(true)
    )

    <br />
    @Html.ActionLink("Regresar a Inicio", "Index", "Home")

</body>
</html>